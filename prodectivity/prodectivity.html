<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/prodectivity/style.css">
    <script src="/prodectivity/weeklyscript.js"></script>

    <script>
  const storedPassword = localStorage.getItem("appPassword");
  const verified = sessionStorage.getItem("verified");
  const onPasswordPage = location.pathname.endsWith("/password.html");

  // Only bounce to password.html if not verified AND you're not already there
  if ((!storedPassword || !verified) && !onPasswordPage) {
    // keep this relative, so under /psycho/ it goes to /psycho/password.html
    window.location.href = "password.html";
  }
</script>

    <script>
  // Single source of truth
  const EMOJI_MAP = [
    { min: 0,   max: 1.5,  emoji: "ğŸ˜©" },
    { min: 1.5, max: 3.0,  emoji: "ğŸ˜”" },
    { min: 3.0, max: 4.5,  emoji: "ğŸ˜•" },
    { min: 4.5, max: 6.0,  emoji: "ğŸ˜" },
    { min: 6.0, max: 7.5,  emoji: "ğŸ˜Š" },
    { min: 7.5, max: 9.0,  emoji: "ğŸ˜ƒ" },
    { min: 9.0, max: 10.01,emoji: "ğŸ¤©" }
  ];

  function emojiFor(val) {
    const v = Number(val) || 0;
    const band = EMOJI_MAP.find(b => v >= b.min && v < b.max);
    return band ? band.emoji : "ğŸ˜Š";
  }

  function updateEmojisFromValue(val) {
    const left   = document.getElementById("left-emoji");
    const center = document.getElementById("center-emoji");
    const right  = document.getElementById("right-emoji");
    if (!left || !center || !right) return;

    const i = EMOJI_MAP.findIndex(b => val >= b.min && val < b.max);
    const cur = i === -1 ? 4 : i; // default to the ğŸ˜Š band

    left.textContent   = EMOJI_MAP[cur - 1] ? EMOJI_MAP[cur - 1].emoji : "";
    center.textContent = EMOJI_MAP[cur].emoji;
    right.textContent  = EMOJI_MAP[cur + 1] ? EMOJI_MAP[cur + 1].emoji : "";
  }
</script>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="theme.js"></script>
    <script src="weeklyscript.js"></script>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="weeklystyle.css">
    <title>My Daily Journal</title>

</head>
<body>
    <div class="container">
        <h1>My Daily Journal</h1>
        <div class="themes">
            <button class="default-color" onclick="toggleTheme('default')">Default Theme</button>
            <button class="blue-color" onclick="toggleTheme('blue')">Sky Blue Theme</button>
            <button class="pink-color" onclick="toggleTheme('pink')">pink Theme</button>
            <button class="purple-color" onclick="toggleTheme('purple')">Purple Theme</button> 
            <button class="dark-color" onclick="toggleTheme('dark')">dark Theme</button> 
        </div>
        <div class="toggle-buttons">
            <!-- <button id="weekly-report" onclick="switchToWeeklyReportMode()">Weekly Report Mode</button> -->
        </div>
        
        <div id="weekly-popup-overlay" onclick="closeWeeklyPopup()"></div>
    <!-- Ø§Ù„Ø¨ÙˆØ¨ Ø£Ø¨ -->
    <div id="weekly-popup">
        <h2>Weekly Report</h2>
        
        <div class="options">
            <select id="month">
                <option value="0">None</option>
                <option value="1">1-January</option>
                <option value="2">2-February</option>
                <option value="3">3-March</option>
                <option value="4">4-April</option>
                <option value="5">5-May</option>
                <option value="6">6-June</option>
                <option value="7">7-July</option>
                <option value="8">8-August</option>
                <option value="9">9-September</option>
                <option value="10">10-October</option>
                <option value="11">11-November</option>
                <option value="12">12-December</option>
            </select>
            <select id="weeks">
                <option value="0">None</option>
                <option value="1">week 1</option>
                <option value="2">week 2</option>
                <option value="3">week 3</option>
                <option value="4">week 4</option>
            </select>
            <input type="text" id="Week-report" placeholder="Week Title" style="text-align: center;">
        </div>
        <textarea 
                id="week-details" 
                placeholder="Week Details" 
                style="
                    text-align: center; 
                    direction: rtl; 
                    max-width: 1200px; 
                    overflow: auto; 
                   
                "
            ></textarea>
            <div class="Week-rating-container">
                <div id="wleft-emoji" class="wemoji faded">ğŸ˜”</div>
                <div id="wcenter-emoji" class="wemoji main">ğŸ˜Š</div>
                <div id="wright-emoji" class="wemoji faded">ğŸ˜ƒ</div>
            </div>
            
            <div class="week-feedback-section">
                <!-- Ø´Ø±ÙŠØ· Ø§Ù„Ø³Ø­Ø¨ Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„ÙŠÙˆÙ… -->
                <label for="weekly-rating" style="font-size: 26px; text-shadow: 2px 2px 4px var(--primary-color);">Week Rating</label>
                <input type="range" id="weekly-rating" min="0" max="10" step="0.25" value="5" class="slider" style="max-width: 900px; width: 90%;">
                <span id="weekly-rating-value" style="font-size: 26px;">5.00/10</span>
                <div id="week-feedback-list"></div>
            </div>
            <button class="close-btn" onclick="closeWeeklyPopup()">Close</button>
        </div>
        <input type="text" id="Journal-title" placeholder="Journal Title" style="width: 100%; max-width: 970px; height: 40px;text-align: center;">
        <div class="template-container">
            <div style="margin-top: 10px;">
                <button class="template1" onclick="showTemplateManager()">Manage Templates</button>
                <input class ="main_date" type="date" id="Journal-date">
                <button class="template2" onclick="applyTemplate()">Apply Template</button>
            </div>
            <textarea 
                id="Journal-details" 
                placeholder="Journal Details" 
                style="
                    text-align: center; 
                    direction: rtl; 
                    max-width: 970px; 
                    overflow: auto; 
                "
            ></textarea>
        </div>
        
        <div id="template-popup" class="popup">
            <div class="popup-header">
                <h2>Manage Templates</h2>
                <button onclick="closeTemplateManager()">Close</button>
            </div>
            <textarea 
                id="template-input"
                placeholder="Enter your template here"
                style="max-width: 90%; height: 100px; margin-bottom: 20px;"
            ></textarea>
            <button onclick="saveTemplate()">Save Template</button>
            <div id="template-list" style="margin-top: 20px;"></div>
        </div>
        
        <div class="Journal-rating-container">
            <div id="left-emoji" class="emoji faded">ğŸ˜”</div>
            <div id="center-emoji" class="emoji main">ğŸ˜Š</div>
            <div id="right-emoji" class="emoji faded">ğŸ˜ƒ</div>
        </div>
        
        <div class="feedback-section">
            <!-- Ø´Ø±ÙŠØ· Ø§Ù„Ø³Ø­Ø¨ Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„ÙŠÙˆÙ… -->
            <label for="daily-rating" style="font-size: 26px; text-shadow: 2px 2px 4px var(--primary-color);">Day Rating</label>
            <input type="range" id="daily-rating" min="0" max="10" step="0.25" value="5" class="slider" style="max-width: 950px; width: 100%;">
            <span id="daily-rating-value" style="font-size: 26px;">5.00/10</span>
            <div id="feedback-list"></div>
        </div>
<button onclick="addJournal()">Add Journal</button>
<button onclick="showJournalsPopup()">Show Journals (<span id="Journal-count">0</span>)</button>
</div>
    <div class="popup" id="Journals-popup">
        <div class="popup-header">
            <h2>All Journals</h2>
            <button onclick="closeJournalsPopup()">Close</button>
        </div>
        <div class="sort-controls">
            <select id="sort-type" onchange="sortJournals()">
                <option value="date">Sort by Date</option>
                <option value="rating">Sort by Rating</option>
                <option value="title">Sort by Title</option>
            </select>
            <select id="direction" onchange="sortJournals()">
                <option value="A">Asce</option>
                <option value="D">Desc</option>
            </select>
            
            <button onclick="exportJournals()">Export Journals</button>
        </div>
        <div id="Journals-list"></div>
    </div>
    
    
    

    <canvas id="chart" style="display: none;"></canvas>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
    /* Connect local UI to backend API */
    const API_BASE = "/api/psycho/entries";

    async function apiFetch(url, options) {
        try {
            const res = await fetch(url, options);
            if (!res.ok) {
                const body = await res.text();
                throw new Error(`HTTP ${res.status} ${res.statusText}: ${body}`);
            }
            if (res.status === 204) return null;
            const ct = res.headers.get("content-type") || "";
            return ct.includes("application/json") ? await res.json() : await res.text();
        } catch (err) {
            console.error("apiFetch error:", err);
            throw err;
        }
    }

    async function apiListJournals() {
        return await apiFetch(API_BASE, { method: "GET" });
    }

    async function apiAddJournal(entry) {
        return await apiFetch(API_BASE, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(entry)
        });
    }

    async function apiDeleteJournal(id) {
        await apiFetch(`${API_BASE}/${encodeURIComponent(id)}`, { method: "DELETE" });
        return true;
    }

    async function apiUpdateJournal(id, entry) {
        return await apiFetch(`${API_BASE}/${encodeURIComponent(id)}`, {
            method: "PUT",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(entry)
        });
    }
    </script>
    <script>

        let Journals = [];
        let isRedTheme = true;
        // Ù…ØµÙÙˆÙØ© Ø§Ù„Ù‚ÙˆØ§Ù„Ø¨ Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©
let templates = JSON.parse(localStorage.getItem("templates")) || [];

// Ø¹Ø±Ø¶ Ù†Ø§ÙØ°Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù‚ÙˆØ§Ù„Ø¨
function showTemplateManager() {
    const popup = document.getElementById("template-popup");
    popup.style.zIndex = "1000";
    popup.style.top = "5%";
    popup.style.opacity = "1";
    popup.style.transform = "translateX(-50%) scale(1)";
    renderTemplates();
}

// Ø¥ØºÙ„Ø§Ù‚ Ù†Ø§ÙØ°Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù‚ÙˆØ§Ù„Ø¨
function closeTemplateManager() {
    const popup = document.getElementById("template-popup");
    popup.style.top = "-100%";
    popup.style.opacity = "0";
    popup.style.transform = "translateX(-50%) scale(0.8)";
}

// Ø­ÙØ¸ Ù‚Ø§Ù„Ø¨ Ø¬Ø¯ÙŠØ¯
function saveTemplate() {
    const templateInput = document.getElementById("template-input").value.trim();
    if (!templateInput) {
        alert("Template cannot be empty!");
        return;
    }
    templates.push(templateInput);
    localStorage.setItem("templates", JSON.stringify(templates));
    document.getElementById("template-input").value = "";
    renderTemplates();
}

// Ø¹Ø±Ø¶ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù‚ÙˆØ§Ù„Ø¨ Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©
function renderTemplates() {
    const templateList = document.getElementById("template-list");
    templateList.innerHTML = "";

    if (templates.length === 0) {
        templateList.textContent = "No templates available.";
        return;
    }

    templates.forEach((template, index) => {
        const templateItem = document.createElement("div");
        templateItem.style.display = "flex";
        templateItem.style.justifyContent = "space-between";
        templateItem.style.alignItems = "center";
        templateItem.style.marginBottom = "10px";
        templateItem.style.padding = "10px";
        templateItem.style.background = "var(--container-color)";
        templateItem.style.borderRadius = "5px";
        templateItem.style.boxShadow = "0 0 5px var(--primary-color)";

        const templateText = document.createElement("p");
        templateText.textContent = template;
        templateText.style.color = "white";
        templateText.style.margin = "0";
        templateItem.appendChild(templateText);

        const useButton = document.createElement("button");
        useButton.textContent = "Use";
        useButton.style.marginRight = "10px";
        useButton.style.backgroundColor = "var(--secondary-color)";
        useButton.style.color = "white";
        useButton.style.border = "none";
        useButton.style.borderRadius = "5px";
        useButton.style.cursor = "pointer";
        useButton.onclick = () => applyTemplate(index);
        templateItem.appendChild(useButton);

        const deleteButton = document.createElement("button");
        deleteButton.textContent = "Delete";
        deleteButton.style.backgroundColor = "red";
        deleteButton.style.color = "white";
        deleteButton.style.border = "none";
        deleteButton.style.borderRadius = "5px";
        deleteButton.style.cursor = "pointer";
        deleteButton.onclick = () => deleteTemplate(index);
        templateItem.appendChild(deleteButton);

        templateList.appendChild(templateItem);
    });
}

// Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù‚Ø§Ù„Ø¨
function applyTemplate(index) {
    const template = index !== undefined ? templates[index] : templates[0];
    if (!template) {
        alert("No templates available.");
        return;
    }
    document.getElementById("Journal-details").value = template;
    closeTemplateManager();
}

// Ø­Ø°Ù Ù‚Ø§Ù„Ø¨
function deleteTemplate(index) {
    templates.splice(index, 1);
    localStorage.setItem("templates", JSON.stringify(templates));
    renderTemplates();
}

        




        function updateJournalCount() {
            console.log("Journals:", Journals); // Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù…ØµÙÙˆÙØ© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
    console.log("Number of Journals:", Journals.length); // Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø¹Ø¯Ø¯
            document.getElementById("Journal-count").textContent = Journals.length;
        }

        function sortJournals() {
            const sortType = document.getElementById("sort-type").value;
            const directionType = document.getElementById("direction").value;
            switch(sortType) {
                case 'date':
                    if(directionType=='A')
                    Journals.sort((a, b) => new Date(a.date) - new Date(b.date));
                    else if(directionType=='D')
                    Journals.sort((a, b) => new Date(b.date) - new Date(a.date));
                    break;
                case 'rating':
                if(directionType=='A')
                Journals.sort((a, b) => a.dailyRating - b.dailyRating);
                else  if(directionType=='D')
                Journals.sort((a, b) => b.dailyRating - a.dailyRating);
                    break;
                case 'title':
                if(directionType=='A')
                Journals.sort((a, b) => a.title.localeCompare(b.title));
                else if(directionType=='D')
                Journals.sort((a, b) => b.title.localeCompare(a.title));
                    break;
            }  
        }  
/*            
apiAddJournal({
    title,
    date,
    details,
    dailyRating
});*/

  window.addEventListener("DOMContentLoaded", async () => {
    // set default date
    const d = new Date();
    const yyyy = d.getFullYear();
    const mm = String(d.getMonth()+1).padStart(2,"0");
    const dd = String(d.getDate()).padStart(2,"0");
    const dateEl = document.getElementById("Journal-date");
    if (dateEl) dateEl.value = `${yyyy}-${mm}-${dd}`;

    // slider hookups
    const ratingSlider = document.getElementById("daily-rating");
    const ratingValue  = document.getElementById("daily-rating-value");

    function onSliderInput() {
      const v = parseFloat(ratingSlider.value || "0");
      if (ratingValue) ratingValue.textContent = `${v.toFixed(2)}/10`;
      updateEmojisFromValue(v);
    }
    if (ratingSlider) {
      ratingSlider.addEventListener("input", onSliderInput);
      onSliderInput();
    }

    // load existing journals from backend
    try {
      window.Journals = await apiListJournals();
      updateJournalCount();
    } catch (e) {
      console.error("Failed to load journals:", e);
    }
  });

  function toast(msg) {
    const t = document.createElement("div");
    t.textContent = msg;
    Object.assign(t.style, {
      position: "fixed",
      bottom: "20px",
      left: "50%",
      transform: "translateX(-50%)",
      background: "var(--secondary-color)",
      color: "#fff",
      padding: "10px 16px",
      borderRadius: "8px",
      boxShadow: "0 4px 12px rgba(0,0,0,.3)",
      zIndex: 2000,
      transition: "opacity .3s"
    });
    document.body.appendChild(t);
    setTimeout(() => (t.style.opacity = "0"), 1300);
    setTimeout(() => t.remove(), 1700);
  }

// ---- 3. Then your addJournal() and other functions below ----
async function addJournal() {
  const title = document.getElementById("Journal-title").value.trim();
  const date = document.getElementById("Journal-date").value;
  const details = document.getElementById("Journal-details").value.trim();
  const dailyRating = parseFloat(document.getElementById("daily-rating").value || "0");

  if (!date || !details) {
    alert("Please fill in all required fields!");
    return;
  }

  try {
    const payload = { title, date, details, dailyRating };
    const saved = await apiAddJournal(payload);

    const normalized = {
      id: saved.id,
      title: saved.title,
      date: saved.date,
      details: saved.details,
      dailyRating: typeof saved.mood === "number" ? saved.mood : dailyRating,
      emoji: emojiFor(typeof saved.mood === "number" ? saved.mood : dailyRating),
    };

    window.Journals = window.Journals || [];
    window.Journals.push(normalized);
    updateJournalCount();

    document.getElementById("Journal-title").value = "";
    document.getElementById("Journal-details").value = "";
    toast("âœ… Added to psychoanalytical.json");
  } catch (err) {
    console.error("Add failed:", err);
    alert("Failed to add journal. See console for details.");
  }
}


// ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø±Ù…ÙˆØ² Ø§Ù„ØªØ¹Ø¨ÙŠØ±ÙŠØ© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø¤Ø´Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯
function updateEmojis(newIndex, ratingValue) {
    currentIndex = Math.min(Math.max(0, newIndex), EMOJI_MAP.length - 1);

    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø±Ù…ÙˆØ² Ø§Ù„ØªØ¹Ø¨ÙŠØ±ÙŠØ©
    const leftEmoji = document.getElementById("left-emoji");
    const centerEmoji = document.getElementById("center-emoji");
    const rightEmoji = document.getElementById("right-emoji");
    
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†ØµÙˆØµ Ù„Ù„Ø¥ÙŠÙ…ÙˆØ¬ÙŠØ§Øª
    leftEmoji.textContent = currentIndex > 0 ? EMOJI_MAP[currentIndex - 1].emoji : '';
    centerEmoji.textContent = EMOJI_MAP[currentIndex].emoji;
    rightEmoji.textContent = currentIndex < EMOJI_MAP.length - 1 ? EMOJI_MAP[currentIndex + 1].emoji : '';
    
    // ØªØ­Ø¯ÙŠØ« Ù‚ÙŠÙ…Ø© Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù…Ø¹Ø±ÙˆØ¶Ø©
    document.getElementById("daily-rating-value").textContent = `${ratingValue}`;
    
}

// Ù…Ø³ØªÙ…Ø¹ Ù„Ù„Ø­Ø¯Ø« Ø¹Ù„Ù‰ Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ…Ø±ÙŠØ±
document.getElementById("daily-rating").addEventListener("input", function () {
    const ratingValue = parseFloat(this.value); // Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¯Ù‚ÙŠÙ‚Ø© Ù„Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ…Ø±ÙŠØ±
    let newIndex = 0;

    // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø¥ÙŠÙ…ÙˆØ¬ÙŠ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù†Ø·Ø§Ù‚Ø§Øª
    for (let i = 0; i < EMOJI_MAP.length; i++) {
        if (ratingValue >= EMOJI_MAP[i].min && ratingValue < EMOJI_MAP[i].max) {
            newIndex = i;
            break;
        }
    }

    updateEmojis(newIndex, ratingValue);
});

// ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø¥ÙŠÙ…ÙˆØ¬ÙŠ Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
window.onload = function () {
    const initialRating = parseFloat(document.getElementById("daily-rating").value);
    let initialIndex = 0;

    // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø¥ÙŠÙ…ÙˆØ¬ÙŠ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù†Ø·Ø§Ù‚Ø§Øª
    for (let i = 0; i < EMOJI_MAP.length; i++) {
        if (initialRating >= EMOJI_MAP[i].min && initialRating < EMOJI_MAP[i].max) {
            initialIndex = i;
            break;
        }
    }

    updateEmojis(initialIndex, initialRating);
};
function showJournalsPopup() {
    const JournalsList = document.getElementById("Journals-list");
    JournalsList.innerHTML = "";

    Journals.forEach((Journal, index) => {
        const JournalItem = document.createElement("div");
        JournalItem.className = "Journal-item";

        // Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙŠÙˆÙ… Ø¨Ø­Ø¬Ù… Ø£ÙƒØ¨Ø±
        const JournalTitle = document.createElement("h2");
        JournalTitle.className="Journal-title";

// Ø§Ù„Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
JournalTitle.style.fontWeight = "bold";
JournalTitle.style.color = "white"; // ØªØºÙŠÙŠØ± Ø§Ù„Ù„ÙˆÙ† Ø¥Ù„Ù‰ Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ
JournalTitle.style.textShadow = "0 0 5px black";
JournalTitle.style.wordWrap = "break-word"; // ÙŠÙƒØ³Ø± Ø§Ù„ÙƒÙ„Ù…Ø§Øª
JournalTitle.style.lineHeight = "1.5"; // Ø§Ù„Ù…Ø³Ø§ÙØ© Ø¨ÙŠÙ† Ø§Ù„Ø£Ø³Ø·Ø±
JournalTitle.style.textAlign = "left"; // Ù…Ø­Ø§Ø°Ø§Ø© Ø§Ù„Ù†Øµ
JournalTitle.style.overflowWrap = "break-word"; // ÙƒØ³Ø± Ø§Ù„Ù†Øµ Ø§Ù„Ø·ÙˆÙŠÙ„
JournalTitle.style.fontSize = "1.9rem"; // Ø§Ù„Ø­Ø¬Ù… Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ
JournalTitle.style.whiteSpace = "normal"; // Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨ØªØºÙ„ÙŠÙ Ø§Ù„Ù†ØµÙˆØµ
JournalTitle.style.overflow = "hidden"; // Ù…Ù†Ø¹ Ø§Ù„ØªÙ…Ø±ÙŠØ±
JournalTitle.style.display = "block"; // Ù„Ø¶Ù…Ø§Ù† Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø§Ù„Ø¹Ø±Ø¶ ÙˆØ§Ù„Ø§Ø±ØªÙØ§Ø¹
JournalTitle.style.textAlign="center";

// ØªÙ‚Ø³ÙŠÙ… Ø§Ù„Ù†Øµ Ø¥Ù„Ù‰ Ø£Ø³Ø·Ø± ÙƒÙ„ 5 ÙƒÙ„Ù…Ø§Øª
const words = Journal.title.split(" ");
const lines = [];
for (let i = 0; i < words.length; i += 5) {
  lines.push(words.slice(i, i + 5).join(" ")); // Ø¬Ù…Ø¹ ÙƒÙ„ 5 ÙƒÙ„Ù…Ø§Øª ÙÙŠ Ø³Ø·Ø±
}
JournalTitle.innerHTML = lines.join("<br>"); // Ø¯Ù…Ø¬ Ø§Ù„Ø£Ø³Ø·Ø± Ù…Ø¹ Ø¥Ø¶Ø§ÙØ© ÙÙˆØ§ØµÙ„ Ø£Ø³Ø·Ø±

// Ø¶Ø¨Ø· Ø­Ø¬Ù… Ø§Ù„Ø®Ø· Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠÙ‹Ø§ Ù„ØªÙ†Ø§Ø³Ø¨ Ø§Ù„Ø¹Ù†ØµØ±
JournalTitle.style.fontSize = "1.9rem"; // Ø§Ù„Ø­Ø¬Ù… Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ
JournalTitle.style.whiteSpace = "normal"; // Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨ØªØºÙ„ÙŠÙ Ø§Ù„Ù†ØµÙˆØµ

// ÙˆØ¸ÙŠÙØ© Ù„Ø¶Ø¨Ø· Ø§Ù„Ø­Ø¬Ù… ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§
function adjustFontSize(element) {
  const parent = element.parentElement || document.body; // Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ø¹Ù†ØµØ±
  const maxHeight = parent.offsetHeight || 350; // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ù„Ø§Ø±ØªÙØ§Ø¹ (Ø¥ÙØªØ±Ø§Ø¶ÙŠÙ‹Ø§)
  const maxWidth = parent.offsetWidth || 300; // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ù„Ø¹Ø±Ø¶ (Ø¥ÙØªØ±Ø§Ø¶ÙŠÙ‹Ø§)
  let fontSize = parseFloat(window.getComputedStyle(element).fontSize);

  // ØªÙ‚Ù„ÙŠØµ Ø§Ù„Ù†Øµ Ø¥Ø°Ø§ ØªØ¬Ø§ÙˆØ² Ø§Ù„Ø­Ø¬Ù…
  while (
    (element.scrollHeight > maxHeight || element.scrollWidth > maxWidth) &&
    fontSize > 10 // Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ù„Ø­Ø¬Ù… Ø§Ù„Ø®Ø·
  ) {
    fontSize -= 1; // ØªÙ‚Ù„ÙŠÙ„ Ø­Ø¬Ù… Ø§Ù„Ø®Ø· ØªØ¯Ø±ÙŠØ¬ÙŠÙ‹Ø§
    element.style.fontSize = `${fontSize}px`;
  }
}

// Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙˆØ¶Ø¨Ø· Ø§Ù„Ø­Ø¬Ù… Ø¹Ù†Ø¯ Ø¥Ø¶Ø§ÙØªÙ‡ Ù„Ù„Ø­Ø§ÙˆÙŠØ©
document.body.appendChild(JournalTitle); // Ø£Ø¶Ù Ø§Ù„Ø¹Ù†ØµØ± Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
adjustFontSize(JournalTitle);
        const Journaldate = document.createElement("h2");
        Journaldate.style.fontSize = "1.3rem";
        Journaldate.style.fontWeight = "bold";
        Journaldate.style.color = "white";  // ØªØºÙŠÙŠØ± Ø§Ù„Ù„ÙˆÙ† Ø¥Ù„Ù‰ Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ
        Journaldate.style.textShadow = " 0 0 5px black ";  
        Journaldate.textContent = Journal.date;

        // Ø¹Ø±Ø¶ Ø§Ù„Ø¥ÙŠÙ…ÙˆØ¬ÙŠ
        const JournalEmoji = document.createElement("span");
        JournalEmoji.style.fontSize = "3rem"; // Ø­Ø¬Ù… Ø§Ù„Ø¥ÙŠÙ…ÙˆØ¬ÙŠ
        JournalEmoji.textContent = Journal.emoji;
        JournalEmoji.style.textShadow="0px 0px 10px yellow";

        // ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©
        const JournalRating = document.createElement("div");
        JournalRating.className = "Journal-rating";
        JournalRating.textContent = `(Day Rating: ${Journal.dailyRating}/10)`; // Ø¹Ø±Ø¶ Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„ÙŠÙˆÙ…ÙŠ

        // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù„ÙˆÙ† Ø§Ù„Ù…ØªØºÙŠØ± CSS
        const secondaryColor = getComputedStyle(document.documentElement).getPropertyValue('--secondary-color').trim();

        // ØªØ·Ø¨ÙŠÙ‚ textShadow
        JournalRating.style.textShadow = `2px 2px 2px ${secondaryColor}`;

        // Ù†Øµ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø© Ø§Ù„Ù…Ø®ØªØµØ±
        const JournalDetails = document.createElement("div");
        JournalDetails.className = "Journal-details";
        const previewText = Journal.details.split('\n')[0].split(' ', 9).join(' ') + '...';
        JournalDetails.textContent = previewText;

        // Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ø£Ø²Ø±Ø§Ø±
        const actionsContainer = document.createElement("div");
        actionsContainer.className = "Journal-actions";

        // Ø²Ø± Ø§Ø³ØªØ¹Ø±Ø§Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„
        const showButton = document.createElement("button");
        showButton.className = "show-button";
        showButton.textContent = "Show Details";
        showButton.onclick = () => viewJournalDetails(index);

        // Ø²Ø± Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
        const editButton = document.createElement("button");
        editButton.textContent = "Edit";
        editButton.onclick = () => editJournalDetails(index);

        // Ø²Ø± Ø§Ù„Ø­Ø°Ù
        const deleteButton = document.createElement("button");
        deleteButton.textContent = "Delete";
        deleteButton.onclick = () => confirmDelete(index);

        // Ø¥Ø±ÙØ§Ù‚ Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø¯Ø§Ø®Ù„ Ø§Ù„Ø­Ø§ÙˆÙŠØ©
        actionsContainer.appendChild(showButton);
        actionsContainer.appendChild(editButton);
        actionsContainer.appendChild(deleteButton);

        // Ø¥Ø±ÙØ§Ù‚ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©
        JournalItem.appendChild(JournalTitle);
        JournalItem.appendChild(Journaldate);
        JournalItem.appendChild(JournalEmoji);  // Ø¥Ø±ÙØ§Ù‚ Ø§Ù„Ø¥ÙŠÙ…ÙˆØ¬ÙŠ Ù‡Ù†Ø§
        JournalItem.appendChild(JournalRating);
        JournalItem.appendChild(JournalDetails);
        JournalItem.appendChild(actionsContainer);

        JournalsList.appendChild(JournalItem);
    });

    const popup = document.getElementById("Journals-popup");
    popup.style.zIndex = "1000";
    popup.style.top = "5%";
    popup.style.opacity = "1";
    popup.style.transform = "translateX(-50%) scale(1)";
}
function confirmDelete(JournalIndex) {
    const confirmationPopup = document.createElement("div");
    confirmationPopup.className = "confirmation-popup";
    confirmationPopup.style.position = "fixed";
    confirmationPopup.style.top = "50%";
    confirmationPopup.style.left = "50%";
    confirmationPopup.style.transform = "translate(-50%, -50%)";
    confirmationPopup.style.zIndex = "1100";
    confirmationPopup.style.backgroundColor = "var(--container-color)";
    confirmationPopup.style.padding = "20px";
    confirmationPopup.style.boxShadow = "0 0 10px rgba(0, 0, 0, 0.5)";
    confirmationPopup.style.borderRadius = "8px";
    

    const message = document.createElement("p");
    message.textContent = "Are you sure you want to delete this Journal?";
    message.style.marginBottom = "20px";

    const confirmButton = document.createElement("button");
    confirmButton.textContent = "Confirm";
    confirmButton.style.marginRight = "10px";
    confirmButton.onclick = () => {
        deleteJournal(JournalIndex);
        document.body.removeChild(confirmationPopup);
    };

    const cancelButton = document.createElement("button");
    cancelButton.textContent = "Cancel";
    cancelButton.onclick = () => {
        document.body.removeChild(confirmationPopup);
    };

    confirmationPopup.appendChild(message);
    confirmationPopup.appendChild(confirmButton);
    confirmationPopup.appendChild(cancelButton);

    document.body.appendChild(confirmationPopup);
}
function viewJournalDetails(index) {
    const Journal = Journals[index];

    // Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø§ÙØ°Ø© Ù…Ù†Ø¨Ø«Ù‚Ø© Ù„ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©
    const detailPopup = document.createElement("div");
    detailPopup.style.position = "fixed";
    detailPopup.style.top = "5%";
    detailPopup.style.left = "50%";
    detailPopup.style.transform = "translateX(-50%)";
    detailPopup.style.width = "90%";
    detailPopup.style.height = "80%";
    detailPopup.style.backgroundColor = "var(--container-color)";
    detailPopup.style.border = `4px solid var(--secondary-color)`;
    detailPopup.style.borderRadius = "10px";
    detailPopup.style.zIndex = "1200";
    detailPopup.style.padding = "20px";
    detailPopup.style.overflowY = "auto";
    detailPopup.style.boxShadow = "0 0 20px rgba(0, 0, 0, 0.8)";

    // Ø±Ø£Ø³ Ø§Ù„ØµÙØ­Ø©
    const header = document.createElement("div");
    header.style.display = "flex";
    header.style.justifyContent = "space-between";
    header.style.alignItems = "center";
    header.style.marginBottom = "20px";

    const title = document.createElement("h2");
    title.textContent = Journal.title;
    title.style.textAlign = "center";
    title.style.flex = "1";
    title.style.color = "var(--secondary-color)";
    title.style.fontSize = "3rem";
    title.style.fontWeight = "bold";

    const date = document.createElement("span");
    date.textContent = Journal.date;
    date.style.color = "white";
    date.style.fontSize = "2rem";

    const rating = document.createElement("div");
    rating.style.display = "flex";
    rating.style.alignItems = "center";
    rating.style.gap = "10px"; // Ù…Ø³Ø§ÙØ© Ø¨ÙŠÙ† Ø§Ù„ØªÙ‚ÙŠÙŠÙ… ÙˆØ§Ù„Ø¥ÙŠÙ…ÙˆØ¬ÙŠ

    const r = document.createElement("span");
    r.textContent = `(${Journal.dailyRating || 0}/10)`;
    r.style.color = "white";
    r.style.fontSize = "2rem";

    const emoji = document.createElement("span");
    emoji.textContent = Journal.emoji || "ğŸ˜Š"; // Ø¹Ø±Ø¶ Ø§Ù„Ø¥ÙŠÙ…ÙˆØ¬ÙŠ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯Ù‹Ø§
    emoji.style.fontSize = "2.5rem"; // Ø­Ø¬Ù… Ø§Ù„Ø¥ÙŠÙ…ÙˆØ¬ÙŠ
    emoji.style.textShadow = "0 0 10px yellow"; // ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø´ÙƒÙ„

    // Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªÙ‚ÙŠÙŠÙ… ÙˆØ§Ù„Ø¥ÙŠÙ…ÙˆØ¬ÙŠ Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø§ÙˆÙŠØ©
    rating.appendChild(r);
    rating.appendChild(emoji);

    // Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù†Øµ
    const content = document.createElement("div");
content.textContent = Journal.details;
content.style.color = "white";
content.style.fontSize = "1.5rem";
content.style.lineHeight = "1.0";
content.style.direction = "rtl";  // Ù„Ø¬Ø¹Ù„ Ø§Ù„Ù†Øµ Ù…Ù† Ø§Ù„ÙŠÙ…ÙŠÙ† Ù„Ù„ÙŠØ³Ø§Ø±
content.style.textAlign = "center";  // Ù„Ø¬Ø¹Ù„ Ø§Ù„Ù†Øµ ÙÙŠ Ø§Ù„Ù…Ù†ØªØµÙ Ø£ÙÙ‚ÙŠÙ‹Ø§
content.style.whiteSpace = "pre-wrap";  // Ù„Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø³Ø·Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ÙˆØ§Ù„Ù…Ø³Ø§ÙØ§Øª
content.style.display = "block";  // Ù„Ø¶Ù…Ø§Ù† ØªØ±ØªÙŠØ¨ Ø§Ù„Ù†Øµ ÙÙˆÙ‚ Ø¨Ø¹Ø¶Ù‡ Ø§Ù„Ø¨Ø¹Ø¶
content.style.width = "100%";  // Ø¬Ø¹Ù„ Ø§Ù„Ø¹Ù†ØµØ± ÙŠØ´ØºÙ„ Ø§Ù„Ù…Ø³Ø§Ø­Ø© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„

    // Ø²Ø± Ø§Ù„Ø¥ØºÙ„Ø§Ù‚
    const closeButton = document.createElement("button");
    closeButton.textContent = "Close";
    closeButton.style.position = "fixed";
    closeButton.style.bottom = "10px";
    closeButton.style.left = "50%";
    closeButton.style.transform = "translateX(-50%)";
    closeButton.style.backgroundColor = "var(--primary-color)";
    closeButton.style.color = "white";
    closeButton.style.padding = "10px 20px";
    closeButton.style.border = "none";
    closeButton.style.borderRadius = "5px";
    closeButton.style.cursor = "pointer";
    closeButton.style.zIndex = "1300";
    closeButton.style.maxWidth="450px";
    closeButton.onclick = () => {
        document.body.removeChild(detailPopup);
        document.body.removeChild(closeButton);
        
    };

    // Ø¨Ù†Ø§Ø¡ Ø§Ù„Ù‡ÙŠÙƒÙ„
    header.appendChild(date);
    header.appendChild(title);
    header.appendChild(rating);

    detailPopup.appendChild(header);
    detailPopup.appendChild(content);
    document.body.appendChild(detailPopup);
    document.body.appendChild(closeButton);
}

function editJournalDetails(index) {
    const Journal = Journals[index];

    // Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø§ÙØ°Ø© Ù…Ù†Ø¨Ø«Ù‚Ø© Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©
    const editPopup = document.createElement("div");
    editPopup.style.position = "fixed";
    editPopup.style.top = "5%";
    editPopup.style.left = "50%";
    editPopup.style.transform = "translateX(-50%)";
    editPopup.style.width = "90%";
    editPopup.style.height = "90%";
    editPopup.style.backgroundColor = "var(--container-color)";
    editPopup.style.border = `4px solid var(--secondary-color)`;
    editPopup.style.borderRadius = "10px";
    editPopup.style.zIndex = "1200";
    editPopup.style.padding = "20px";
    editPopup.style.overflowY = "auto";
    editPopup.style.boxShadow = "0 0 20px rgba(0, 0, 0, 0.8)";

    // Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ Ù„Ù„ØªØ¹Ø¯ÙŠÙ„
    const titleInput = document.createElement("input");
    titleInput.type = "text";
    titleInput.value = Journal.title;
    titleInput.style.width = "90%";
    titleInput.style.marginBottom = "10px";
    titleInput.style.padding = "10px";
    titleInput.style.fontSize = "1rem";

    const dateInput = document.createElement("input");
    dateInput.type = "date";
    dateInput.value = Journal.date;
    dateInput.style.width = "90%";
    dateInput.style.marginBottom = "10px";
    dateInput.style.padding = "10px";
    dateInput.style.fontSize = "1rem";

    const dailyRatingContainer = document.createElement("div");
    dailyRatingContainer.style.display = "flex";
dailyRatingContainer.style.alignItems = "center";
dailyRatingContainer.style.gap="1%" // ØªØºÙŠÙŠØ± Ù‡Ø°Ø§ ÙÙ‚Ø·
dailyRatingContainer.style.padding = "20px";
dailyRatingContainer.style.width = "100%";
    

    const dailyRatingInput = document.createElement("input");
    dailyRatingInput.type = "range";
    dailyRatingInput.min = "0";
    dailyRatingInput.max = "10";
    dailyRatingInput.step = "0.25";
    dailyRatingInput.value = Journal.dailyRating;
    dailyRatingInput.style.width = "80%"; // Ø¹Ø±Ø¶ Ø«Ø§Ø¨Øª
dailyRatingInput.style.flexShrink = "0"; // Ù…Ù†Ø¹ Ø§Ù„ØªÙ‚Ù„Øµ

    const dailyRatingValue = document.createElement("span");
    dailyRatingValue.textContent = Journal.dailyRating;
    
    dailyRatingValue.style.color = "white";
    dailyRatingValue.style.minWidth = "5%"; // Ø¹Ø±Ø¶ Ø«Ø§Ø¨Øª
    dailyRatingValue.style.fontSize = "2rem";

    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥ÙŠÙ…ÙˆØ¬ÙŠ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…
    const emojiMapping = [
        { emoji: "ğŸ˜©", min: 0, max: 1.5 },
        { emoji: "ğŸ˜”", min: 1.5, max: 3 },
        { emoji: "ğŸ˜•", min: 3, max: 4.5 },
        { emoji: "ğŸ˜", min: 4.5, max: 6 },
        { emoji: "ğŸ˜Š", min: 6, max: 7.5 },
        { emoji: "ğŸ˜ƒ", min: 7.5, max: 9 },
        { emoji: "ğŸ¤©", min: 9, max: 10 }
    ];

    function getEmojiFromRating(rating) {
        for (let i = 0; i < emojiMapping.length; i++) {
            if (rating >= emojiMapping[i].min && rating < emojiMapping[i].max) {
                return emojiMapping[i].emoji;
            }
        }
        return "ğŸ˜Š"; // Ø§Ù„Ø¥ÙŠÙ…ÙˆØ¬ÙŠ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ
    }

    const emojiDisplay = document.createElement("span");
    emojiDisplay.textContent = getEmojiFromRating(Journal.dailyRating);
    emojiDisplay.style.fontSize = "3rem";
    emojiDisplay.style.minWidth = "5%"; // Ø¹Ø±Ø¶ Ø«Ø§Ø¨Øª
emojiDisplay.style.textAlign = "center";
emojiDisplay.style.textShadow="0px 0px 10px yellow";

    dailyRatingInput.oninput = () => {
        dailyRatingValue.textContent = dailyRatingInput.value;
        emojiDisplay.textContent = getEmojiFromRating(dailyRatingInput.value);
    };

    dailyRatingContainer.appendChild(dailyRatingInput);
    dailyRatingContainer.appendChild(emojiDisplay);
    dailyRatingContainer.appendChild(dailyRatingValue);

    const detailsInput = document.createElement("textarea");
    detailsInput.value = Journal.details;
    detailsInput.style.width = "100%";
    detailsInput.style.height = "200px";
    detailsInput.style.marginBottom = "10px";
    detailsInput.style.padding = "10px";
    detailsInput.style.fontSize = "1rem";

    // Ø²Ø± Ø§Ù„Ø­ÙØ¸
    const saveButton = document.createElement("button");
    saveButton.textContent = "Save";
    saveButton.style.backgroundColor = "var(--primary-color)";
    saveButton.style.color = "white";
    saveButton.style.padding = "10px 20px";
    saveButton.style.border = "none";
    saveButton.style.borderRadius = "5px";
    saveButton.style.cursor = "pointer";
    saveButton.style.marginRight = "10px";
    // Ø²Ø± Ø§Ù„Ø­ÙØ¸ (Ø§Ø³ØªØ¨Ø¯Ù„ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ Ø¨Ù‡Ø°Ø§)
saveButton.onclick = async () => {
  try {
    // build payload in the API shape (dailyRating is OK; backend maps it to mood)
    const payload = {
      title: titleInput.value,
      date:  dateInput.value,
      details: detailsInput.value,
      dailyRating: parseFloat(dailyRatingInput.value)
    };

    // call UPDATE (not add) using the server id
    const updated = await apiUpdateJournal(Journal.id, payload);

    // keep local copy in sync; backend returns {id,title,date,details,mood}
    const normalized = {
      ...Journals[index],
      ...updated,
      dailyRating: typeof updated.mood === "number" ? updated.mood : payload.dailyRating,
      emoji: getEmojiFromRating(typeof updated.mood === "number" ? updated.mood : payload.dailyRating)
    };
    Journals[index] = normalized;

    // re-render list and close editor
    document.body.removeChild(editPopup);
    showJournalsPopup();
  } catch (err) {
    console.error("Update failed:", err);
    alert("Failed to save changes. Please try again.");
  }
};


    // Ø²Ø± Ø§Ù„Ø¥ØºÙ„Ø§Ù‚
    const closeButton = document.createElement("button");
    closeButton.textContent = "Close";
    closeButton.style.backgroundColor = "var(--secondary-color)";
    closeButton.style.color = "white";
    closeButton.style.padding = "10px 20px";
    closeButton.style.border = "none";
    closeButton.style.borderRadius = "5px";
    closeButton.style.cursor = "pointer";
    closeButton.onclick = () => document.body.removeChild(editPopup);

    // Ø¨Ù†Ø§Ø¡ Ø§Ù„Ù‡ÙŠÙƒÙ„
    editPopup.appendChild(titleInput);
    editPopup.appendChild(dateInput);
    editPopup.appendChild(dailyRatingContainer);
    editPopup.appendChild(detailsInput);
    editPopup.appendChild(saveButton);
    editPopup.appendChild(closeButton);

    document.body.appendChild(editPopup);
}



        function closeJournalsPopup() {
            
            const popup = document.getElementById("Journals-popup");
    popup.style.top = "-100%"; // ØªØ­Ø±ÙŠÙƒ Ø§Ù„Ø¨ÙˆØ¨ Ø§Ø¨ Ø¥Ù„Ù‰ Ø®Ø§Ø±Ø¬ Ø§Ù„Ø´Ø§Ø´Ø©
    popup.style.zIndex = "-1"; // Ø¬Ø¹Ù„ Ø§Ù„Ø²-index Ù…Ù†Ø®ÙØ¶Ù‹Ø§ Ù„ÙŠÙƒÙˆÙ† Ø®Ù„Ù Ø§Ù„ØµÙØ­Ø©
    popup.style.opacity = "0"; // ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø´ÙØ§ÙÙŠØ© Ø¥Ù„Ù‰ 0 Ù„Ø¬Ø¹Ù„ Ø§Ù„Ø¨ÙˆØ¨ Ø§Ø¨ ØºÙŠØ± Ù…Ø±Ø¦ÙŠ
    popup.style.transform = "translateX(-50%) scale(0.8)"; // ØªÙ‚Ù„ÙŠØµ Ø§Ù„Ø­Ø¬Ù… Ø¥Ù„Ù‰ 80% Ø¹Ù†Ø¯ Ø§Ù„Ø¥ØºÙ„Ø§Ù‚

        }

       function toast(msg) {
    const t = document.createElement("div");
    t.textContent = msg;
    Object.assign(t.style, {
      position: "fixed",
      bottom: "20px",
      left: "50%",
      transform: "translateX(-50%)",
      background: "var(--secondary-color)",
      color: "#fff",
      padding: "10px 16px",
      borderRadius: "8px",
      boxShadow: "0 4px 12px rgba(0,0,0,.3)",
      zIndex: 2000,
      transition: "opacity .3s"
    });
    document.body.appendChild(t);
    setTimeout(() => (t.style.opacity = "0"), 1300);
    setTimeout(() => t.remove(), 1700);
  }

  async function addJournal() {
    const title = document.getElementById("Journal-title").value.trim();
    const date = document.getElementById("Journal-date").value;
    const details = document.getElementById("Journal-details").value.trim();
    const dailyRating = parseFloat(document.getElementById("daily-rating").value || "0");

    if (!date || !details) {
      alert("Please fill in all required fields!");
      return;
    }

    // prevent duplicate date in the UI list (optional)
    /*
    const isDuplicate = (window.Journals || []).some(j => j.date === date);
    if (isDuplicate) {
      alert("A journal with this date already exists. Please choose another date.");
      return;
    }*/

    // call backend
    try {
      const payload = { title, date, details, dailyRating };
      const saved = await apiAddJournal(payload); // POST /api/psycho/entries

      // backend returns {id,title,date,details,mood}
      const normalized = {
        id: saved.id,
        title: saved.title,
        date: saved.date,
        details: saved.details,
        dailyRating: typeof saved.mood === "number" ? saved.mood : dailyRating,
        emoji: emojiFor(typeof saved.mood === "number" ? saved.mood : dailyRating)
      };

      window.Journals = window.Journals || [];
      window.Journals.push(normalized);
      updateJournalCount();

      // reset inputs
      document.getElementById("Journal-title").value = "";
      document.getElementById("Journal-details").value = "";

      toast("âœ… Added to psychoanalytical.json");
    } catch (err) {
      console.error("Add failed:", err);
      alert("Failed to add journal. See console for details.");
    }
  }
function deleteJournal(index) {
    // Ø­Ø°Ù Ø§Ù„ÙŠÙˆÙ…ÙŠØ© Ù…Ù† Ø§Ù„Ù…ØµÙÙˆÙØ©
    Journals.splice(index, 1); 
    
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ localStorage
    localStorage.setItem("Journals", JSON.stringify(Journals));

    // ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
    updateJournalCount();
    showJournalsPopup(); // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙŠÙˆÙ…ÙŠØ§Øª ÙÙŠ Ø§Ù„Ù€ Popup
}
        function clearInputs() {
            document.getElementById("Journal-title").value = "";
            document.getElementById("Journal-date").value = "";
            document.getElementById("Journal-details").value = "";
        }

        updateJournalCount();

    </script>   

</body>
</html>